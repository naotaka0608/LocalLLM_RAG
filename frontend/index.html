<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local LLM RAG System</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <div class="app-layout">
        <!-- サイドバー -->
        <div class="sidebar">
            <div class="sidebar-header">
                <button class="btn-new-chat" onclick="createNewChat()">+ 新規チャット</button>
            </div>
            <div class="chat-history" id="chatHistory">
                <!-- チャット履歴がここに表示される -->
            </div>
            <div class="sidebar-footer">
                <button class="btn-clear-history" onclick="clearAllHistory()">🗑️ 全ての履歴を削除</button>
            </div>
        </div>

        <!-- メインコンテンツ -->
        <div class="container">
            <div class="header">
                <h1>Local LLM RAG System</h1>
                <p>Powered by Ollama, LangChain & FastAPI</p>
            </div>

            <div class="main-tabs">
                <button class="main-tab active" onclick="switchMainTab('chat')">💬 チャット</button>
                <button class="main-tab" onclick="switchMainTab('settings')">⚙️ 設定</button>
            </div>

        <div id="chat-main" class="main-tab-content active">
            <div class="card">
                <h2>チャット</h2>
                <div style="margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px; display: flex; align-items: center; gap: 10px;">
                    <label style="font-weight: 600; color: #333; white-space: nowrap; display: flex; align-items: center; gap: 5px;">
                        <input type="checkbox" id="queryExpansionToggle" style="width: 18px; height: 18px; cursor: pointer;">
                        クエリ拡張
                    </label>
                    <span style="font-size: 0.8rem; color: #666;">（高精度だが遅い - 複雑な質問向け）</span>
                </div>
                <div class="chat-area">
                    <div class="chat-messages" id="chatMessages">
                        <div class="message assistant">
                            <div class="message-header">アシスタント</div>
                            <div>
                                <p style="font-size: 0.95rem;">こんにちは！ファイルをアップロードして、質問してください。</p>
                                <div style="margin-top: 8px; padding: 8px; background: #f0f8ff; border-left: 3px solid #667eea; border-radius: 5px; font-size: 0.85rem;">
                                    <strong>💡 より精度の高い回答を得るコツ:</strong>
                                    <ul style="margin: 5px 0 0 18px; padding: 0;">
                                        <li>具体的で明確な質問をする（例: 「○○の手順を教えてください」）</li>
                                        <li>コンテキストを含める（例: 「Pythonで○○する方法」）</li>
                                        <li>ドキュメント内の用語を使う（専門用語や正式名称）</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="input-area">
                        <input
                            type="text"
                            id="questionInput"
                            placeholder="質問を入力してください..."
                            onkeypress="handleKeyPress(event)"
                        >
                        <button class="btn btn-primary" onclick="sendQuestion()">送信</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="settings-main" class="main-tab-content">
            <div class="settings-grid">
                <div class="card">
                    <h2>📄 ドキュメント管理</h2>
                    <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                        <div class="upload-icon">📄</div>
                        <p>クリックまたはドラッグ＆ドロップ</p>
                        <p style="font-size: 0.85rem; color: #666; margin-top: 5px;">対応: PDF, TXT, MD, CSV</p>
                        <input type="file" id="fileInput" accept=".pdf,.txt,.md,.csv" multiple onchange="uploadFiles()">
                    </div>
                </div>

                <div class="card">
                    <h2>📚 登録済みドキュメント</h2>
                    <ul class="document-list" id="documentList">
                        <li style="text-align: center; color: #999;">ドキュメントなし</li>
                    </ul>
                    <button class="btn btn-danger" onclick="clearDocuments()" style="width: 100%; margin-top: 10px;">
                        全て削除
                    </button>
                </div>

                <div class="card">
                    <h2>⚡ 性能プリセット</h2>
                    <p style="font-size: 0.85rem; color: #666; margin-bottom: 10px;">回答速度と精度のバランスを選択</p>
                    <select id="performancePreset" onchange="applyPerformancePreset()" style="width: 100%; padding: 10px; border-radius: 5px; border: 2px solid #e0e0e0; font-size: 0.95rem; margin-bottom: 10px;">
                        <option value="balanced">⚖️ バランス（推奨）</option>
                        <option value="speed">🚀 高速優先</option>
                        <option value="quality">🎯 高精度優先</option>
                        <option value="custom">🔧 カスタム</option>
                    </select>
                    <div id="presetDescription" style="font-size: 0.8rem; color: #666; padding: 8px; background: #f8f9fa; border-radius: 5px; margin-top: 5px;">
                        速度と精度のバランスが取れた設定です
                    </div>
                </div>

                <div class="card">
                    <h2>🤖 モデル設定</h2>
                    <select id="modelSelectSettings" style="width: 100%; padding: 10px; border-radius: 5px; border: 2px solid #e0e0e0; font-size: 0.95rem; margin-bottom: 10px;">
                        <option value="">デフォルト (llama3.2)</option>
                    </select>
                    <button onclick="loadModels()" style="width: 100%; padding: 8px 12px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 0.9rem;">
                        🔄 モデル再読み込み
                    </button>
                    <div id="modelCount" style="font-size: 0.85rem; color: #666; margin-top: 10px;"></div>
                </div>

                <div class="card" id="advancedSettings" style="display: none;">
                    <h2>🔧 詳細設定</h2>
                    <div style="margin-bottom: 10px;">
                        <label style="font-size: 0.9rem; color: #333; display: block; margin-bottom: 5px;">
                            Temperature (創造性): <span id="tempValue">0.3</span>
                        </label>
                        <input type="range" id="temperatureSlider" min="0" max="1" step="0.1" value="0.3"
                               oninput="updateTemperature(this.value)"
                               style="width: 100%;">
                        <div style="font-size: 0.75rem; color: #999;">低い: 一貫性↑ 高い: 創造性↑</div>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <label style="font-size: 0.9rem; color: #333; display: block; margin-bottom: 5px;">
                            検索ドキュメント数: <span id="docsValue">5</span>
                        </label>
                        <input type="range" id="docsSlider" min="3" max="10" step="1" value="5"
                               oninput="updateDocs(this.value)"
                               style="width: 100%;">
                        <div style="font-size: 0.75rem; color: #999;">少ない: 高速↑ 多い: 精度↑</div>
                    </div>
                </div>

                <div class="card">
                    <h2>⚙️ システム状態</h2>
                    <div id="healthStatus">確認中...</div>
                </div>
            </div>
        </div>
        </div>
    </div>

    <script src="/js/script.js"></script>
</body>
</html>
